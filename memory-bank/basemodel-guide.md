# BaseModel Architecture Guide

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–°–æ–∑–¥–∞–Ω–∞ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–µ–π —Å –±–∞–∑–æ–≤–æ–π –º–æ–¥–µ–ª—å—é –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ UUID primary keys –≤–æ –≤—Å–µ–º –ø—Ä–æ–µ–∫—Ç–µ.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. BaseModel (Abstract)
**–§–∞–π–ª**: `app/Models/BaseModel.php`

```php
abstract class BaseModel extends Model
{
    use HasUuids;
    
    public $incrementing = false;
    protected $keyType = 'string';
    
    protected function casts(): array
    {
        return [
            'created_at' => 'datetime',
            'updated_at' => 'datetime',
        ];
    }
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –≤—Å–µ—Ö –æ–±—ã—á–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –ø—Ä–æ–µ–∫—Ç–∞.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ UUID primary keys
- –û–±—â–∏–µ cast –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ú–µ—Å—Ç–æ –¥–ª—è –æ–±—â–∏—Ö model events

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–ª—è –æ–±—ã—á–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç BaseModel)
```php
class TelegramUser extends BaseModel
{
    use HasFactory;
    
    protected $fillable = [
        'telegram_id',
        'username',
        // ...
    ];
    
    protected function casts(): array
    {
        return array_merge(parent::casts(), [
            'telegram_id' => 'integer',
            'settings' => 'array',
        ]);
    }
}
```

### –î–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HasUuids)
```php
class User extends Authenticatable
{
    use HasFactory, Notifiable, HasUuids, HasRoles;
    
    public $incrementing = false;
    protected $keyType = 'string';
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
}
```

### –î–ª—è –º–æ–¥–µ–ª–µ–π —Ç—Ä–µ—Ç—å–∏—Ö –ø–∞–∫–µ—Ç–æ–≤
```php
class Permission extends SpatiePermission
{
    use HasUuids;
    
    public $incrementing = false;
    protected $keyType = 'string';
    
    protected $fillable = [
        'name',
        'guard_name',
    ];
}
```

## –ú–∏–≥—Ä–∞—Ü–∏–∏

–í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å UUID primary keys:

```php
Schema::create('table_name', function (Blueprint $table) {
    $table->uuid('id')->primary();
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
    $table->timestamps();
});
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### UUID Validation Helper
```php
private function isValidUuid(string $uuid): bool
{
    return preg_match('/^[0-9a-f]{8}-[0-9a-f]{4}-[47][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i', $uuid) === 1;
}
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç UUID v4 –∏ v7 (Laravel 12 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç v7 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
```php
public function test_model_uses_uuid(): void
{
    $model = ModelName::create([...]);
    
    $this->assertIsString($model->id);
    $this->assertTrue($this->isValidUuid($model->id));
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –í—Å–µ –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç UUID
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### 2. DRY –ø—Ä–∏–Ω—Ü–∏–ø
- –û–±—â–∏–µ cast –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ BaseModel
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ UUID –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π

### 3. –ì–∏–±–∫–æ—Å—Ç—å
- BaseModel –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- HasUuids –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ç—Ä–µ—Ç—å–∏–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏

### 4. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –û–±—â–∏–µ helper –º–µ—Ç–æ–¥—ã
- –ü–æ–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π:
1. **–û–±—ã—á–Ω—ã–µ –º–æ–¥–µ–ª–∏**: –ù–∞—Å–ª–µ–¥—É–π—Ç–µ—Å—å –æ—Ç `BaseModel`
2. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `HasUuids` –≤ `Authenticatable`
3. **–¢—Ä–µ—Ç—å–∏ –ø–∞–∫–µ—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `HasUuids` + —è–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
4. **–ú–∏–≥—Ä–∞—Ü–∏–∏**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `uuid('id')->primary()`

### –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å relationships:
```php
// Foreign keys —Ç–æ–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å UUID
$table->uuid('user_id');
$table->foreign('user_id')->references('id')->on('users');
```

### –ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:
- –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ UUID generation
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ relationships —Å UUID
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—â–∏–π helper –¥–ª—è validation

## –°—Ç–∞—Ç—É—Å
‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: BaseModel, –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å UUID  
‚úÖ **–£–ø—Ä–æ—â–µ–Ω–æ**: –£–¥–∞–ª–µ–Ω –ª–∏—à–Ω–∏–π trait, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Laravel's HasUuids –Ω–∞–ø—Ä—è–º—É—é  
‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ**: Unit –∏ Feature —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å  
üìã **–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π 